// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String @id @default(cuid())
  walletAddress   String @unique
  firstVisitTime  Int    // Unix timestamp when user first entered the site
  labsBalance     Int    // LABS balance of the user
  xLABSBalance    Int    // xLABS balance of the user
  stakedBalance   Int    // Staked balance of the user
  unstakedBalance Int    // Unstaked balance of the user
  pendingRewards  Int    // Pending rewards of the user
  interestIndex   Int    // Interest index of the user
  bump            Int    // Bump of the user
  totalXLabsClaimed Int @default(0) // Total xLABS claimed by this user
  pendingXLabsClaim Int @default(0) // xLABS pending to be claimed by this user
  lastClaimTime   Int?   // Unix timestamp of last xLABS claim (nullable)
  lastPendingUpdate Int?  // Unix timestamp of last pending xLABS update
  lastBalanceUpdate Int?  // Unix timestamp of last balance update
  lastStakeTime     Int?  // Unix timestamp of last stake action
  lastUnstakeTime   Int?  // Unix timestamp of last unstake action

  @@map("users")
}

model GlobalStats {
  id                String @id @default("global") // Single row with fixed ID
  totalXLabsClaimed Int    @default(0) // Total xLABS claimed across all users
  totalPendingXLabs Int    @default(0) // Total xLABS pending to be claimed across all users
  totalUsers        Int    @default(0) // Total number of users
  totalStaked       Int    @default(0) // Total amount staked across all users
  lastUpdated       Int    // Unix timestamp of last update
  createdAt         DateTime @default(now())

  @@map("global_stats")
}

model DailyAnalytics {
  id              String   @id @default(cuid())
  date            String   // Date in YYYY-MM-DD format for easy querying
  timestamp       Int      // Unix timestamp for the end of the day
  
  // LABS Staking Activity Data (for EChartLabsStaked)
  totalStaked     Int      @default(0) // Total amount staked on this day
  totalUnstaked   Int      @default(0) // Total amount unstaked on this day
  netStaked       Int      @default(0) // Net staking activity (staked - unstaked)
  cumulativeStaked Int     @default(0) // Cumulative staked amount at end of day
  
  // xLABS Rewards Activity Data (for EChartXLabsData)
  totalClaimed    Int      @default(0) // Total xLABS claimed on this day
  totalPending    Int      @default(0) // Total xLABS pending at end of day
  dailyRewardsGenerated Int @default(0) // New rewards generated on this day
  
  // General metrics
  activeUsers     Int      @default(0) // Number of users who interacted on this day
  newUsers        Int      @default(0) // Number of new users who joined on this day
  totalUsers      Int      @default(0) // Total cumulative users at end of day
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([date]) // Ensure one record per day
  @@map("daily_analytics")
}
